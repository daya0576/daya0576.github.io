<canvas id="rain-canvas"></canvas>
<style>
  #rain-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 30vh;
    pointer-events: none;
    z-index: 9999;
    opacity: 0.45;
    filter: blur(0.5px);
    -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 100%);
    mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 40%, rgba(0,0,0,0) 100%);
  }
</style>
<script>
(function () {
  const canvas = document.getElementById('rain-canvas');
  const ctx = canvas.getContext('2d');

  /* ---------- tuning knobs ---------- */
  const DROP_COUNT  = 90;       // number of drops on screen
  const SPEED_MIN   = 5;        // px per frame (min)
  const SPEED_MAX   = 9;        // px per frame (max)
  const LEN_MIN     = 12;       // streak length min
  const LEN_MAX     = 55;       // streak length max
  const WIND_ANGLE  = -0.12;    // radians (~-7°) — slight left diagonal
  const ANGLE_JITTER = 0.01;    // ±jitter per drop for natural variation
  const ALPHA_MIN   = 0.2;
  const ALPHA_MAX   = 0.55;
  const THICKNESS   = 1;        // line width in px

  /* ---------- state ---------- */
  let W, H;
  const drops = [];

  function resize() {
    const dpr = Math.min(window.devicePixelRatio || 1, 2);
    W = window.innerWidth;
    H = window.innerHeight * 0.4;
    canvas.width  = W * dpr;
    canvas.height = H * dpr;
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }

  function makeDrop(startAtTop) {
    const speed = SPEED_MIN + Math.random() * (SPEED_MAX - SPEED_MIN);
    const angle = WIND_ANGLE + (Math.random() * 2 - 1) * ANGLE_JITTER;
    return {
      x: Math.random() * (W + 60) - 30,
      y: startAtTop ? -(Math.random() * 40) : Math.random() * H,
      len: LEN_MIN + Math.random() * (LEN_MAX - LEN_MIN),
      speed: speed,
      alpha: ALPHA_MIN + Math.random() * (ALPHA_MAX - ALPHA_MIN),
      dx: Math.sin(angle),
      dy: Math.cos(angle),
    };
  }

  function init() {
    resize();
    drops.length = 0;
    for (let i = 0; i < DROP_COUNT; i++) drops.push(makeDrop(false));
  }

  /* ---------- render loop ---------- */

  function frame() {
    ctx.clearRect(0, 0, W, H);
    ctx.lineWidth = THICKNESS;
    ctx.lineCap = 'round';

    for (let i = 0; i < drops.length; i++) {
      const d = drops[i];

      ctx.strokeStyle = 'rgba(200,210,220,' + d.alpha + ')';
      ctx.beginPath();
      ctx.moveTo(d.x, d.y);
      ctx.lineTo(d.x + d.dx * d.len, d.y + d.dy * d.len);
      ctx.stroke();

      d.x += d.dx * d.speed;
      d.y += d.dy * d.speed;

      // recycle when drop falls off screen
      if (d.y > H + d.len) {
        const nd = makeDrop(true);
        nd.y = -(nd.len + Math.random() * 40);
        drops[i] = nd;
      }
    }

    requestAnimationFrame(frame);
  }

  /* ---------- kick off ---------- */
  // Respect reduced-motion preference
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

  init();
  frame();
  window.addEventListener('resize', resize);
})();
</script>
