(function(k){var m=new Class({Implements:[Options,Events],options:{$button:$$(".J_btnShare")[0]},initialize:function(e){this.setOptions(e);this.share()},openLite:function(e,d,c,g){var b=DP.mbox;b.close();b.open({winCls:"pop-win",closable:!1,size:d||{x:"auto",y:"auto"},url:b.dialog(null,'<div class="comment-form" id="J_pop_form"><div class="form-block" style="text-align:center">'+e+(c?'<a href="javascript:void(0);" class="close-txt J_btnClose">[关闭]</a>':"")+"</div></div>")});$("J_pop_form").getParent().setStyles({margin:0,
padding:0});c&&$("J_pop_form").getElement(".J_btnClose").addEvent("click",function(c){c.stop();b.close()});g&&("number"==typeOf(g)?setTimeout(function(){b.close()},g):"boolean"==typeOf(g)&&g&&setTimeout(function(){b.close()},1500))},share:function(){var e=this,d=e.options.$button,c=d.getParent("span").getNext(".J_boxShare");if(d){var g;d.addEvents({mouseenter:function(a){a.stop();clearTimeout(g);c.removeClass("Hide").addEvents({mouseenter:function(a){a.stop();clearTimeout(g);$(this).removeClass("Hide")},
mouseleave:function(a){a.stop();$(this).addClass("Hide")}})},mouseleave:function(a){a.stop();g=setTimeout(function(){c.addClass("Hide")},100)}});var b=encodeURIComponent,d=$("mainNoteInfo").getElements("img"),m=/\.gif$/,h=[],l=0;d.length&&d.forEach(function(a){var b,c,d=a.get("data-lazyload")||a.get("src");if(d&&!d.test(m)){var f=a.get("width"),a=a.get("height");if(f&&a)b=f,c=a,300<=b&&300<=c&&(l++,9>=l&&h.push(d));else{var e=new Image;e.onload=function(){b=e.width;c=e.height;300<=b&&300<=c&&(l++,
9>=l&&h.push(d))};e.src=d}}});b(location.href);var i=b("我在大众点评社区发现一篇超赞的帖子，推荐给你：【"+k.data("noteTitle")+"】"),f=location.href,j=b('"'+k.data("partNoteBody")+'"'),d=c.getElement(".J_kaixin"),n=c.getElement(".J_qqt"),o=c.getElement(".J_sinat"),p=c.getElement(".J_qzone"),q=c.getElement(".J_renren"),r=c.getElement(".J_zhannei"),f=-1==f.indexOf("?")?f+"?":f+"&";d.removeEvents().addEvent("click",function(a){a.stop();pageTracker._trackPageview("dp_club_groupnote_shareP_kaixin");a=b(h.join(","));a="http://www.kaixin001.com/rest/records.php?url="+
b(f+"utm_source=kaixin&utm_term=share&utm_content=topic")+"&mod=5&link=2&style=11&content="+i+j+"&pic="+a;window.open(a,"_blank")});n.removeEvents().addEvent("click",function(a){a.stop();pageTracker._trackPageview("dp_club_groupnote_shareP_qq");a=b(h.join("||"));a="http://share.v.t.qq.com/index.php?c=share&a=index&appkey=1392673069&url="+b(f+"utm_source=tqq&utm_term=share&utm_content=topic")+"&title="+i+j+"&pic="+a;window.open(a,"_blank")});o.removeEvents().addEvent("click",function(a){a.stop();pageTracker._trackPageview("dp_club_groupnote_shareP_weibo");
a=b(h.join("||"));a="http://service.weibo.com/share/share.php?appkey=1392673069&url="+b(f+"utm_source=weibo&utm_term=share&utm_content=topic")+"&title="+i+j+"&pic="+a;window.open(a,"_blank")});p.removeEvents().addEvent("click",function(a){a.stop();pageTracker._trackPageview("dp_club_groupnote_shareP_tqq");a=b(h.join("|"));a="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+b(f+"utm_source=qq&utm_term=share&utm_content=topic")+"&title="+i+"&summary="+j+"&pics="+a;window.open(a,"_blank")});
q.removeEvents().addEvent("click",function(a){a.stop();pageTracker._trackPageview("dp_club_groupnote_shareP_renren");var a=b(h.join("||")),c=b(f+"utm_source=renren&utm_term=share&utm_content=topic");window.open("http://widget.renren.com/dialog/share?resourceUrl="+c+"&srcUrl="+c+"&title="+i+"&description="+j+"&images="+a,"_blank")});r.removeEvents().addEvent("click",function(a){a.stop();pageTracker._trackPageview("dp_club_groupnote_shareP_nei");a=b(f+"utm_source=nei&utm_term=share&utm_content=topic");
(new Request.JSON({url:"/share.v",method:"POST",data:{"do":"g",ct:i,lk:a,pr:"",tt:i,ttype:3,uid:k.data("uid")},onRequest:function(){e.openLite("正在处理，请稍候...")},onSuccess:function(a){a&&200==a.code?e.openLite(a.msg,"",!1,!0):e.openLite(a.msg,"",!0)},onFailure:function(){e.openLite("服务器错误...","",!0,!1)}})).send()})}}});k.SShare=m})(DP);
