page&&Object.merge(page,{noteQuote:function(){var e=$("mainNoteInfo");if(e){var c=$("mainNoteUser").get("html"),d=$("mainNoteTime").get("html"),d=d.replace("&nbsp;",""),e='<span style="color:#555">以下是引用'+c+"于"+d+"的发言</span><br>"+e.get("html");page.editor&&page.editor.setContent(page.editor.getContent()+'<div class="quote">'+e+"</div><br>");location.replace("#NoteAdd");page.editor.focus()}},addPostScore:function(e){(new AjaxReq({url:"/ajax/json/group/note/userScoreAddLimit",method:"post",data:{noteId:e},
onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(c){if(c&&200==c.code){MBOX.close();MBOX.open({winCls:"pop-win",size:{x:300},url:MBOX.dialog("帖子加分",'<div class="pop-msg-box pmb-error" style="display:none" id="J_d_msg">请填写加分原因</div><div class="pop-win-inner"><div class="form-block"><label for="" class="label">选择分值：</label><select class="form-select form-select-s" id="J_d_score" style="width:80px"><option value=1>学分+1</option><option value=2>学分+2</option><option value=3>学分+3</option></select><label class="label" style="width:100px;color:gray">今日还剩'+
c.msg.data+'分</label></div><div class="form-block"><label for="" class="label">加分原因：</label><textarea type="text" class="form-textarea form-default row3fix" rows="3" id="J_area_reason" placeholder="最多25个字"></textarea></div><div class="form-btn-block"><span class="btn-type-a btn-fn-a"><a class="form-btn" href="javascript:;" id="J_pop_ok">确定</a></span><span class="btn-type-a btn-fn-b"><a class="form-btn" href="javascript:;" id="J_pop_cancel">取消</a></span></div></div>')});var d=$("J_area_reason"),b=
$("J_d_msg"),a=d.get("placeholder"),g=$("J_d_score");$("J_pop_ok").addEvent("click",function(c){c.stop();c=d.get("value").trim();0===c.length||c==a?b.set("html","请填写加分原因").setStyle("display",""):25<c.length?b.set("html","最多25个字").setStyle("display",""):(new AjaxReq({url:"/ajax/json/group/note/addScore",method:"post",data:{noteId:e,score:g.value,comment:c.cnEncode()},onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(a){MBOX_openLite(a.msg&&
a.msg.html||"操作成功",{x:170});setTimeout(function(){refreshPage()},1500)}})).send()});$("J_pop_cancel").addEvent("click",function(a){a.stop();MBOX.close()});BindPlaceHolder(d)}else MBOX_openLite(c.msg&&c.msg.html||"发生未知错误，请稍候再试！",{x:220}),setTimeout(function(){MBOX.close()},1500)}})).send()},noteDelete:function(e,c){(new AjaxReq({url:"/ajax/json/group/note/deleteNote",method:"get",data:"",onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},
!0)},onSuccess:function(d){if(d&&200==d.code){var d=d.msg.data||[],b=[];b.push('<li><input type="radio" id="J_d_0" name="reason" class="chk-item" value=0 /><label for="J_d_0">不扣分删除</label><span class="note">不扣学分</span></li>');for(var a=0;a<d.length;a++)b.push('<li><input type="radio" id="J_d_'+(a+1)+'" name="reason" class="chk-item" value='+d[a].typeid+' /><label for="J_d_'+(a+1)+'">'+d[a].typename+'</label><span class="note">学分 <em>'+d[a].score+"</em></span></li>");b.push('<div class="form-block" style="display:none" id="J_delete_reason"><textarea class="form-textarea form-default" rows="3" id="J_area_reason" placeholder="选填"></textarea></div>');
MBOX.close();MBOX.open({winCls:"pop-win",size:{x:300},url:MBOX.dialog("删除帖子",'<div class="pop-msg-box pmb-error" style="display:none" id="J_d_msg"></div><div class="pop-win-inner"><p class="form-intro">请选择一项原因删除该贴：</p><fieldset><ul class="chk-list" id="J_check_list">'+b.join("")+'</ul></fieldset><div class="pop-btn-wrapper"><span class="btn-type-a btn-fn-a"><a class="form-btn" href="javascript:;" id="J_pop_ok">确定</a></span><span class="btn-type-a btn-fn-b"><a class="form-btn" href="javascript:;" id="J_pop_cancel">取消</a></span></div></div>')});
var g=$("J_delete_reason"),h=$("J_d_msg"),f=$("J_area_reason");$$(".chk-item:not(#J_d_6)").addEvent("click",function(){if(!f||"选填"==f.value||"必填"==f.value)f.set("placeholder","选填"),f.removeEvents("focus"),f.removeEvents("blur"),BindPlaceHolder(f)});$("J_d_6").addEvent("click",function(){if(!f||"选填"==f.value||"必填"==f.value)f.set("placeholder","必填"),f.removeEvents("focus"),f.removeEvents("blur"),BindPlaceHolder(f)});$("J_pop_ok").addEvent("click",function(a){a.stop();var b=$$("#J_check_list input:checked");
0===b.length?h.set("html","请选择删除原因").setStyle("display",""):(a=!f||"选填"==f.value||"必填"==f.value?"":f.value.trim().cnEncode(),b=b[0].get("value"),0===a.length&&24==b?h.set("html","请填写原因").setStyle("display",""):page._noteDeleteSubmit(e,c,b,a))});$("J_pop_cancel").addEvent("click",function(a){a.stop();MBOX.close()});$("J_check_list").addEvent("click",function(a){a.stopPropagation();a=a.target;"input"==a.tagName.toLowerCase()&&"radio"==a.type.toLowerCase()&&(g.setStyle("display",""),h.setStyle("display",
"none"))});BindPlaceHolder(f)}else MBOX_openLite(d.msg&&d.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500)}})).send()},_noteDeleteSubmit:function(e,c,d,b){(new AjaxReq({url:"/ajax/json/group/note/deleteNoteSubmit",method:"post",data:"noteId="+e+"&deleteType="+d+"&groupId="+c+"&reason="+b,onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(a){a&&200==a.code?a.msg.redirecturl&&(location.href=
a.msg.redirecturl):(MBOX_openLite(a.msg&&a.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()},lockNote:function(e,c){MBOX.close();MBOX.open({winCls:"pop-win",closable:!1,size:{x:300},url:MBOX.dialog("锁定帖子",'<div class="pop-msg-box pmb-error" style="display:none" id="J_d_msg">无法添加。该榜单的商户数量已经达到上限。</div><div class="pop-win-inner"><div class="form-block"><label for="" class="label">锁贴原因：</label><textarea type="text" class="form-textarea form-default row3fix" rows="3" placeholder="最多25个字" id="J_area_reason"></textarea></div><div class="form-btn-block"><span class="btn-type-a btn-fn-a"><a class="form-btn" href="javascript:;" id="J_pop_ok">确定</a></span><span class="btn-type-a btn-fn-b"><a class="form-btn" href="javascript:;" id="J_pop_cancel">取消</a></span></div></div>')});
var d=$("J_area_reason");$("J_pop_ok").addEvent("click",function(b){b.stop();b="最多25个字"==d.value?"":d.value.trim().cnEncode();(new AjaxReq({url:"/ajax/json/group/note/updateLockNote",method:"post",data:"noteID="+e+"&groupID="+c+"&reason="+b,onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(a){a&&200==a.code?(MBOX_openLite("锁定帖子成功。 ",{x:160},!0),setTimeout(function(){refreshPage()},1500)):(MBOX_openLite(a.msg&&a.msg.html||
"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()});$("J_pop_cancel").addEvent("click",function(b){b.stop();MBOX.close()});BindPlaceHolder(d)},noteOperate:function(e,c,d,b){var a="noteID="+e+"&groupID="+d,g={1:["置顶帖子","确定将该贴置顶？"],2:["取消置顶","确定将该贴取消置顶？"],3:["加精华帖","确定将该贴设为精华帖？"],4:["取消精华","确定将该贴取消精华？"],5:["锁帖","确定将该贴解除锁定？"],6:["取消锁帖","确定将该贴取消锁帖？"],7:["屏蔽帖子","屏蔽此帖吗？"],8:["解除屏蔽","去除屏蔽吗？"],9:["加入黑名单","将该成员加入黑名单吗？"],10:["突出显示","确定在帖子列表中将该贴突出显示？"],11:["取消突出显示","确定取消该贴再帖子列表中的突出显示？"]}[c+
""];g&&(5==c?page.lockNote(e,d):9==c?page.addBlackList(e,d):MBOX_confirm(g[0],g[1],function(){page._noteOperateAction(e,c,d,a,b)}))},_noteOperateAction:function(e,c,d,b,a){var g="";switch(c){case 1:g="updateTopNote";break;case 2:g="updateTopNote";break;case 3:g="updateGoodNote";break;case 4:g="updateGoodNote";break;case 6:g="updateLockNote";break;case 10:g="updateHighLightNote";break;case 11:g="updateHighLightNote"}(new AjaxReq({url:"/ajax/json/group/note/"+g,method:"post",data:b,onRequest:function(){MBOX_openLite("正在处理，请稍候......",
{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(b){if(b&&200==b.code)switch(MBOX_openLite("操作成功。 ",{x:140},!0),c){case 1:case 2:setTimeout(function(){refreshPage()},1500);break;case 3:a.innerHTML="取消精华";a.onclick=function(){page.noteOperate(e,4,d,a);return!1};break;case 4:a.innerHTML="精华";a.onclick=function(){page.noteOperate(e,3,d,a);return!1};break;case 6:MBOX_openLite("取消锁定帖子成功。 ",{x:190},!0),setTimeout(function(){refreshPage()},1500);case 10:a.innerHTML="取消突出显示";
a.onclick=function(){page.noteOperate(e,11,d,a);return!1};break;case 11:a.innerHTML="突出显示",a.onclick=function(){page.noteOperate(e,10,d,a);return!1}}else MBOX_openLite(b.msg&&b.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500)}})).send()},addBlackList:function(e,c){MBOX.close();MBOX.open({winCls:"pop-win",size:{x:300},url:MBOX.dialog("加入黑名单",'<div class="pop-win-inner"><div class="pop-msg-wrapper"><p>确定将该作者加入本部落黑名单吗？</p><div class="pop-btn-wrapper"><span class="btn-type-a btn-fn-a"><a class="form-btn" href="javascript:;" id="J_pop_ok">确定</a></span><span class="btn-type-a btn-fn-b"><a class="form-btn" href="javascript:;" id="J_pop_cancel">取消</a></span></div><div class="pop-note-box">如果要解除黑名单，请在部落管理-<a href="'+
DP.data("memberManagerURL")+'">成员管理</a>中解除</div></div></div>')});$("J_pop_ok").addEvent("click",function(d){d.stop();(new AjaxReq({url:"/ajax/json/group/note/noteAddBlackList",method:"post",data:"noteID="+e+"&groupID="+c,onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(b){b&&200==b.code?(MBOX_openLite("已加入黑名单！ ",{x:170},!0),b.msg.refresh&&setTimeout(function(){refreshPage()},1500)):b&&500==b.code?MBOX_openLite("该作者已经在黑名单中，无需重复加入！ ",
{x:295},!0):(MBOX_openLite(b.msg&&b.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()});$("J_pop_cancel").addEvent("click",function(c){c.stop();MBOX.close()})},noteTypeEdit:function(e,c,d){(new AjaxReq({url:"/ajax/json/group/note/noteCategoryEdit",method:"post",data:"noteId="+e+"&groupId="+c+"&opName=edit",onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(b){if(b&&200==b.code){for(var a=
[],g=b.msg.data.typelist||[],h=0;h<g.length;h++)a.push('<option value="'+g[h].id+'" >'+g[h].name+"</option>");MBOX.close();MBOX.open({winCls:"pop-win",size:{x:300},url:MBOX.dialog("设置分类",'<div class="pop-win-inner"><div class="form-block"><label for="" class="label">当前分类：</label><span class="form-static-field">'+b.msg.data.type.name+'</span></div><div class="form-block"><label for="" class="label">重选分类：</label><select class="form-select" id="J_select_grouptype">'+a.join("")+'</select></div><div class="form-btn-block"><span class="btn-type-a btn-fn-a"><a class="form-btn" href="javascript:;" id="J_pop_ok">确定</a></span><span class="btn-type-a btn-fn-b"><a class="form-btn" href="javascript:;" id="J_pop_cancel">取消</a></span></div></div><div class="pop-note-box">荣誉长老、长老可以在部落管理 - <a href="/group/'+
d+'/notetype">帖子分类</a>中添加修改分类中添加修改分类</div>')});var f=$("J_select_grouptype");$("J_pop_ok").addEvent("click",function(a){a.stop();(new AjaxReq({url:"/ajax/json/group/note/noteCategoryEdit",method:"post",data:"noteId="+e+"&noteCategoryId="+f.get("value")+"&groupId="+c+"&opName=submit",onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(a){a&&200==a.code?(MBOX_openLite("已成功设置分类！ ",{x:175},!0),a.msg.refresh&&setTimeout(function(){refreshPage()},
1500)):(MBOX_openLite(a.msg&&a.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()});$("J_pop_cancel").addEvent("click",function(a){a.stop();MBOX.close()})}else 201==b.code?MBOX_openLite('荣誉长老、长老可以在<a href="/group/'+d+'/notetype" class="BL">帖子分类</a>中添加修改分类。',{x:340},!0):(MBOX_openLite(b.msg&&b.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()},presentDCash:function(e,c,d){MBOX.close();MBOX.open({winCls:"pop-win",size:{x:300},
url:MBOX.dialog("奖励D币",'<div class="pop-msg-box pmb-error" style="display:none" id="J_d_msg"></div><div class="pop-win-inner"><div class="form-block b-label-m b-award"><label class="label" for="">奖励D币数：</label><input class="form-txt" type="text" id="J_dp_count" /></div><p class="form-intro">请选择一项奖励原因：</p><fieldset><ul class="chk-list" id="J_check_list"><li><input type="radio" class="chk-item" id="J_d_1" name="reason" value="上首页推荐，恭喜恭喜！" /><label for="J_d_1">上首页推荐，恭喜恭喜！</label></li><li><input type="radio" class="chk-item" id="J_d_2" name="reason" value="图片拍得不错，鼓励！" /><label for="J_d_2">图片拍得不错，鼓励！</label></li><li><input type="radio" class="chk-item" id="J_d_3" name="reason" value="图文并茂，好帖！" /><label for="J_d_3">图文并茂，好帖！</label></li><li><input type="radio" class="chk-item" id="J_d_4" name="reason" value="真人秀，赞一记！" /><label for="J_d_4">真人秀，赞一记！</label></li><li><input type="radio" class="chk-item" id="J_d_5" name="reason" value="原创好帖，鼓励！" /><label for="J_d_5">原创好帖，鼓励！</label></li><li><input type="radio" class="chk-item" id="J_d_6" name="reason" value="回复也精彩，奖励！" /><label for="J_d_6">回复也精彩，奖励！</label></li><li><input type="radio" class="chk-item" id="J_d_7" name="reason"/><label for="J_d_7">自定义</label><div class="form-block" style="display:none" id="J_other_reason"><textarea class="form-textarea form-default" rows="3" id="J_area_reason" placeholder="请填写原因，最多25字"></textarea></div></li></ul></fieldset><div class="pop-btn-wrapper"><span class="btn-type-a btn-fn-a"><a href="javascript:;" id="J_pop_ok" class="form-btn">确定</a></span><span class="btn-type-a btn-fn-b"><a href="javascript:;" id="J_pop_cancel" class="form-btn">取消</a></span></div></div>')});
var b=$("J_other_reason"),a=$("J_d_msg"),g=$("J_dp_count");$("J_pop_ok").addEvent("click",function(){var b=$$("#J_check_list input:checked"),f=g.get("value").trim()>>0,i=$("J_area_reason").get("value").trim(),i="请填写原因，最多25字"==i?"":i;0===b.length?a.setStyle("display","").set("html","请选择奖励原因"):0>=f?a.setStyle("display","").set("html","D币数必须是非负1-2位数字"):"J_d_7"==b[0].id&&25<i.length?a.setStyle("display","").set("html","自定义最多25字"):"J_d_7"==b[0].id&&0===i.length?a.setStyle("display","").set("html","请填写原因，最多25字"):
(i="J_d_7"!=b[0].id?b[0].get("value"):i,b="noteId="+e+"&referTypeId="+c+"&groupId="+d+"&dCash="+f+"&reason="+i.cnEncode()+"&mainNoteId="+DP.data("noteId"),MBOX.close(),(new AjaxReq({url:"/ajax/json/group/note/noteDCashAdd",method:"post",data:b,onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(a){a&&200==a.code?(MBOX_openLite("已经成功奖励"+f+"D币！ ",{x:210},!0),a.msg.refresh&&setTimeout(function(){refreshPage()},1500)):
(MBOX_openLite(a.msg&&a.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send())});$("J_pop_cancel").addEvent("click",function(a){a.stop();MBOX.close()});$("J_check_list").addEvent("click",function(c){c.stopPropagation();c=c.target;"input"==c.tagName.toLowerCase()&&"radio"==c.type.toLowerCase()&&(b.setStyle("display","J_d_7"==c.id?"":"none"),a.setStyle("display","none"))});g.addEvent("focus",function(){a.setStyle("display","none")});BindPlaceHolder($("J_area_reason"))},
transferGroupNote:function(e){(new AjaxReq({url:"/ajax/json/group/note/findGroupTypeList",method:"post",data:{noteId:e},onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(c){if(c&&200==c.code){for(var d=c.msg.data,c=['<option value="0" selected="selected">选择分类</option>'],b=0;b<d.length;b++)c.push('<option value="'+d[b].typeid+'">'+d[b].typename+"</option>");MBOX.close();MBOX.open({winCls:"pop-win",size:{x:300},url:MBOX.dialog("转移帖子",
'<div class="pop-msg-box pmb-error" style="display:none" id="J_d_msg">请选择目标部落</div><div class="pop-win-inner"><p class="form-intro">将该帖转移到以下部落：</p><fieldset><div class="form-block b-trans"><select class="form-select form-select-s" id="J_select_category">'+c.join("")+'</select><select class="form-select form-select-m" id="J_select_blog"><option value=0>请选择部落名</option></select></div></fieldset><div class="pop-btn-wrapper"><span class="btn-type-a btn-fn-a"><a href="javascript:;" id="J_pop_ok" class="form-btn">确定</a></span><span class="btn-type-a btn-fn-b"><a href="javascript:;" id="J_pop_cancel" class="form-btn">取消</a></span></div></div>')});
var c=$("J_select_category"),a=$("J_select_blog"),g=$("J_d_msg");$("J_pop_ok").addEvent("click",function(b){b.stop();"0"==a.get("value")?g.setStyle("display",""):(new AjaxReq({url:"/ajax/json/group/note/transferNote",method:"post",data:{noteId:e,newGroupId:a.get("value")},onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(a){a&&200==a.code?location.href=a.msg.redirecturl:(MBOX_openLite(a.msg&&a.msg.html||"发生未知错误，请稍候再试！",
{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()});$("J_pop_cancel").addEvent("click",function(a){a.stop();MBOX.close()});c.addEvent("change",function(){var c=['<option value="0" selected="selected">选择讨论区</option>'],e=[];for(b=0;b<d.length;b++)d[b].typeid==$(this).value&&(e=d[b].grouplist);for(var i=0;i<e.length;i++)c.push('<option value="'+e[i].groupid+'">'+e[i].groupname+"</option>");a.set("html",c.join(""))})}else MBOX_openLite(c.msg&&c.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},
1500)}})).send()},mainPostScoreLog:function(){var e=$("J_main_post");e&&(new AjaxReq({url:"/ajax/json/group/note/scorelist",method:"post",data:{noteId:DP.data("noteId")},onSuccess:function(c){if(c&&200==c.code&&0<c.msg.data.length){var d=c.msg.domain||"",b=c.msg.data,a=[],g=$("J_related_post");a.push('<div class="title"><strong>最近加分</strong>：&nbsp;<em>学分'+c.msg.scoreSum+'</em><span class="note">(共获得'+c.msg.commentTotal+"人加分)</span></div><ul>");for(var c=0,h=b.length;c<h;c++)a.push("<li"+(5>c?"":' class="Hide"')+
'><div class="user"><a href="'+d+b[c].userlink+'">'+b[c].user+"</a></div><em>学分 <strong>"+b[c].score+"</strong></em><p>"+b[c].comment+"</p></li>");a.push("</ul>");5<b.length&&a.push('<div class="more"><span class="fn-more"><a href="javascript:;">显示更多</a></span></div>');a.push("</div>");page.marksRecord=(new Element("div",{"class":"b-misc-content b-recent"})).set("html",a.join(""));g?page.marksRecord.inject(g,"before"):e.adopt(page.marksRecord);ListMoreOrLess(page.marksRecord)}}})).send()},operateLog:function(){var e=
$("J_op_info");e&&(new AjaxReq({url:"/ajax/json/group/note/oploglist",method:"post",data:{noteId:DP.data("noteId")},onSuccess:function(c){if(c&&200==c.code)for(var c=c.msg.data,d=0,b=c.length;d<b;d++)e.adopt((new Element("p")).set("html",c[d]))}})).send()},followNoteAdd:function(){},followNoteClean:function(){page&&(page.editor.setContent(""),$("txtValidateCode")&&$("txtValidateCode").set("value",""),$("imgValidateCode")&&$("imgValidateCode").setProperty("src","/ValidateCode_"+Math.floor(1001*Math.random())+
".jpg"))},followNoteDelete:function(e,c){(new AjaxReq({url:"/ajax/json/group/note/deleteNote",method:"get",data:"",onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(d){if(d&&200==d.code){var d=d.msg.data||[],b=[];b.push('<li><input type="radio" id="J_d_0" name="reason" class="chk-item" value=0 /><label for="J_d_0">不扣分删除</label><span class="note">不扣学分</span></li>');for(var a=0;a<d.length;a++)b.push('<li><input type="radio" id="J_d_'+
(a+1)+'" name="reason" class="chk-item" value='+d[a].typeid+' /><label for="J_d_'+(a+1)+'">'+d[a].typename+'</label><span class="note">学分 <em>'+d[a].score+"</em></span></li>");b.push('<div class="form-block" style="display:none" id="J_delete_reason"><textarea class="form-textarea form-default" rows="3" id="J_area_reason" placeholder="选填"></textarea></div>');MBOX.close();MBOX.open({winCls:"pop-win",size:{x:300},url:MBOX.dialog("删除回帖",'<div class="pop-msg-box pmb-error" style="display:none" id="J_d_msg"></div><div class="pop-win-inner"><p class="form-intro">请选择一项原因删除该贴：</p><fieldset><ul class="chk-list" id="J_check_list">'+
b.join("")+'</ul></fieldset><div class="pop-btn-wrapper"><span class="btn-type-a btn-fn-a"><a class="form-btn" href="javascript:;" id="J_pop_ok">确定</a></span><span class="btn-type-a btn-fn-b"><a class="form-btn" href="javascript:;" id="J_pop_cancel">取消</a></span></div></div>')});var g=$("J_delete_reason"),h=$("J_d_msg"),f=$("J_area_reason");$$(".chk-item:not(#J_d_6)").addEvent("click",function(){if(!f||"选填"==f.value||"必填"==f.value)f.set("placeholder","选填"),f.removeEvents("focus"),f.removeEvents("blur"),
BindPlaceHolder(f)});$("J_d_6").addEvent("click",function(){if(!f||"选填"==f.value||"必填"==f.value)f.set("placeholder","必填"),f.removeEvents("focus"),f.removeEvents("blur"),BindPlaceHolder(f)});$("J_pop_ok").addEvent("click",function(a){a.stop();var b=$$("#J_check_list input:checked");0===b.length?h.set("html","请选择删除原因").setStyle("display",""):(a=!f||"选填"==f.value||"必填"==f.value?"":f.value.trim().cnEncode(),b=b[0].get("value"),0===a.length&&24==b?h.set("html","请填写原因").setStyle("display",""):page._followNoteDeleteSubmit(e,
c,b,a))});$("J_pop_cancel").addEvent("click",function(a){a.stop();MBOX.close()});$("J_check_list").addEvent("click",function(a){a.stopPropagation();a=a.target;"input"==a.tagName.toLowerCase()&&"radio"==a.type.toLowerCase()&&(g.setStyle("display",""),h.setStyle("display","none"))});BindPlaceHolder(f)}else MBOX_openLite(d.msg&&d.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500)}})).send()},_followNoteDeleteSubmit:function(e,c,d,b){(new AjaxReq({url:"/ajax/json/group/note/deleteFollowNoteSubmit",
method:"post",data:"followNoteId="+e+"&deleteType="+d+"&groupId="+c+"&reason="+b.cnEncode()+"&mainNoteId="+DP.data("noteId"),onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(a){a&&200==a.code?(MBOX.close(),(a=$("followNote_"+e))&&a.dispose()):(MBOX_openLite(a.msg&&a.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()},followNoteAddBlackList:function(e,c){MBOX.close();MBOX.open({winCls:"pop-win",
size:{x:300},url:MBOX.dialog("加入黑名单",'<div class="pop-win-inner"><div class="pop-msg-wrapper"><p>确定将该作者加入本部落黑名单吗？</p><div class="pop-btn-wrapper"><span class="btn-type-a btn-fn-a"><a class="form-btn" href="javascript:;" id="J_pop_ok">确定</a></span><span class="btn-type-a btn-fn-b"><a class="form-btn" href="javascript:;" id="J_pop_cancel">取消</a></span></div><div class="pop-note-box">如果要解除黑名单，请在部落管理-<a href="'+DP.data("memberManagerURL")+'">成员管理</a>中解除</div></div></div>')});$("J_pop_ok").addEvent("click",
function(d){d.stop();(new AjaxReq({url:"/ajax/json/group/note/followNoteAddBlackList",method:"post",data:"followNoteId="+e+"&groupId="+c+"&mainNoteId="+DP.data("noteId"),onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(b){b&&200==b.code?(MBOX_openLite("已加入黑名单！ ",{x:170},!0),b.msg.refresh&&setTimeout(function(){refreshPage()},1500)):b&&500==b.code?MBOX_openLite("该作者已经在黑名单中，无需重复加入！ ",{x:300},!0):(MBOX_openLite(b.msg&&
b.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()});$("J_pop_cancel").addEvent("click",function(c){c.stop();MBOX.close()})},voteSurvey:function(e,c){var d=$("survey"+e).getElements("input[name=rdoSurvey"+e+"]").filter(function(b){return b.checked});d.length?(d=d.map(function(b){return b.value}).join("|"),(new AjaxReq({url:"/ajax/json/group/note/addvote",method:"post",data:"surveyId="+e+"&surveyType="+c+"&voteValue="+d,onRequest:function(){MBOX_openLite("正在处理，请稍候......",
{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(b){MBOX.close();b&&100==b.code?DP.authBox("加入部落"):200==b.code?(MBOX.open({winCls:"pop-win",closable:!1,size:{x:160,y:60},url:MBOX.dialog(null,'<div class="comment-form" style="text-align:center"><div class="form-block">'+b.msg.html+'<a href="javascript:;" id="J_close" class="close-txt">[关闭]</a></div></div>')}),$("J_close").addEvent("click",function(a){a.stop();page._getSurveyResult(e);page._rewardResult(e);MBOX.close()})):
(MBOX_openLite(b.msg&&b.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()):MBOX_openLite("你没有选择投票的选项，请先选择后再投票! ",{x:310},!0)},_getSurveyResult:function(e){(new AjaxReq({url:"/ajax/json/group/note/surveyresult",method:"post",data:"surveyId="+e,onSuccess:function(c){c&&c.code&&$("survey"+e).set("html",c.msg.html||"操作失败")}})).send()},_rewardResult:function(e){(11750==e||11752==e)&&(new AjaxReq({url:"/EventData.aspx",method:"post",callType:"json",data:{"do":"pa1"},
onSuccess:function(c){c=c.d;if("b"==c){var d="/slot1.swf?v="+Math.floor(999999999*Math.random());MBOX.open({url:$dialog("抽奖",getFlashHtml("sss",d+c,400,270,"window","")),size:{x:420,y:325}})}else d="/slot"+$random(2,4)+".swf?v="+Math.floor(999999999*Math.random()),MBOX.open({url:$dialog("抽奖",getFlashHtml("sss",d+c,400,270,"window","")),size:{x:420,y:325},onClose:function(){window.location.reload(!0)}})}})).send()},getVoteDetail:function(e){(new AjaxReq({url:"/ajax/json/group/note/votedetail",method:"post",
data:"surveyId="+e,onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(c){c&&200==c.code?(MBOX.close(),MBOX.open({winCls:"pop-win",size:{x:500},url:MBOX.dialog("投票结果详情",c.msg.html||"操作失败")})):(MBOX_openLite(c.msg&&c.msg.html||"发生未知错误，请稍候再试！"),setTimeout(function(){MBOX.close()},1500))}})).send()},_followNodeMain:!1,_followNodeId:null,initPage:function(){if(PAGE_DATA){var e=$("J_note_preview"),c=$("J_topic_list"),
d=new Element("div",{"class":"i-expand-footer",html:'<span class="fn-less J_more-btn"><a title="收起" href="javascript:;">收起</a></span>'});c.addEvent("click",function(b){var a=b.target,c=a.get("event-type");if("shrink"==c){var h=a.get("event-data"),f=a.$full;if(h){b&&b.stop();b=function(){a.$handle&&a.$full&&(a.$handle.toggleClass("Hide"),a.$handleNext&&a.$handleNext.toggleClass("Hide"),a.$full.toggleClass("Hide"))};if(!f){"div"==a.tagName.toLowerCase()&&(a=a.getElement("q"));var i=a.getParent(".topic-quote").get("event-data"),
f=h.split("-").pop();if(f=(i=(i=PAGE_DATA[i]?new Element("div",{html:PAGE_DATA[i]}):null)&&f?i.getElementById("data_"+f):null)?i.innerHTML:a.innerHTML)i=d.clone(),i.getElement(".J_more-btn").addEvent("click",b),a.$full=f=(new Element("div",{"class":"i-expand Hide",html:f})).adopt(i),a.getParent(".tq-item").adopt(f),c=a.getParent(".i-entry").set("event-data",h).set("event-type",c),a.$handle=c.$handle=a,a.$handleNext=c.$handleNext=a.getParent().getNext(),a.$full=c.$full=f}b()}}else if("quote"==c){b.stop();
h=a.getParent(".topic-item");c=h.getElement(".topic-quote");h=h.getElement(".topic-entry");if(b="main"==a.get("note-type"))(f=h.getElement("#mainNoteInfo"))&&(h=(new Element("div",{"class":"topic-entry"})).adopt(f.clone()));e.empty();c&&e.adopt(c.clone());h&&e.adopt(h.clone());e.getParent().removeClass("Hide");location.replace("#NoteAdd");page.editor&&page.editor.focus();page._followNodeId=a.get("note-data");page._followNodeMain=b}})}}});
(function(e){function c(b){b.stop();var a=this,c=a.get(d);MBOX_confirm("评为最佳答案","确定将该答案评为最佳回答吗？评定以后将不能再更改结果。",function(){(new AjaxReq({url:"/ajax/json/group/note/addBestReply",method:"post",data:{followNoteId:c,noteId:DP.data("noteId")},onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(b){b&&200==b.code?(MBOX.close(),a.getParent().appendHTML('<span class="solution-i"></span>'),setTimeout(function(){window.location.reload(!0)},
100)):(MBOX_openLite(b&&b.msg||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()},{x:300,y:180})}var d="data-id";e.addEvent("domready",function(){var b;DP.data("hasbest")&&$$("#J_topic_list .topic-item").forEach(function(a){!a.hasClass("ti-leading")&&!a.hasClass("J_user")&&a.addEvents({mouseenter:function(){b=a.retrieve("answer");b||(b=new Element("a",{href:"javascript:;",title:"评为最佳答案","class":"optimum-result",text:"评为最佳答案"}),b.setProperty(d,a.get("id").replace("followNote_",
"")),b.addEvent("click",c),a.store("answer",b).grab(b));a.addClass("active")},mouseleave:function(){a.removeClass("active")}})});$$(".J_pop_login").addEvent("click",function(){(new AjaxReq({url:"/ajax/json/account/info",method:"post",onSuccess:function(a){a&&200==a.code||DP.authBox()}})).send()});var a;$$(".J_relation").addEvent("click",function(b){b&&b.stop();(new AjaxReq({url:"/ajax/json/group/note/loadNoteShop",method:"post",data:{groupId:DP.data("groupId"),noteId:DP.data("noteId")},onRequest:function(){MBOX_openLite("正在获取，请稍候......",
{x:160})},onError:function(){MBOX_openLite("获取失败。  ",{x:140},!0)},onSuccess:function(b){if(b&&200==b.code){var b=b.msg||[],c=function(a){a.stop();a=this.getParent();j.getElements(".J_pop_item").length<=g?a.getElements("input").set("value",""):(j.getFirst()==a&&a.getNext("li").getElement("label").removeClass("Hide"),this.getParent().destroy(),k.removeClass("Hide"))},d=function(){if(a){var b=a.element,c=j.getPosition(),d=b.getPosition(),b=b.getParent().getElement(".J_sj-shop-list");b.setStyle("height",
"auto");var e=b.getCoordinates(),f=window.getScroll().y,f=window.getSize().y-e.top+f-15;e.height>f?0<f&&b.setStyle("height",f):b.setStyle("height","auto");b.setStyles({"overflow-y":Browser.ie?"scroll":"auto",top:d.y-c.y+24})}},e=function(b){var b=new Autocompleter(b,"/ajax/json/group/event/shopSearch",{listCloseBtn:!1,needPosition:!1,context:b.getParent(),width:285,delay:400,maxChoices:100,zIndex:3E3,adjust:{y:-1},content:b,fxOptions:null,extraParams:{cityId:DP.data("cityId")},selectClass:"ac_select",
className:"autocompleter autocompleter_c J_sj-shop-list",parser:function(a){return a&&200==a.code&&a.msg&&a.msg.shop?a.msg.shop:[]},onSelection:function(a,b,c){(a=this.element.getParent().getElement(".J_pop_text_hide"))&&a.set("value",c)}}),c=b.update;b.update=function(b){c.call(this,b);a=this;b&&b.length&&d()};b.makeUrl=function(){var a=this.url+"?q="+encodeURIComponent(this.queryValue),b;for(b in this.extraParams)a+="&"+b+"="+encodeURIComponent(this.extraParams[b]);return a}},f=[],i={id:"",name:""};
MBOX.close();b.forEach(function(a,b){var c='<li class="p-item J_pop_item" style="overflow:visible"><label class="label Hide">商户名：</label><input type="text" class="form-txt J_pop_text" value="{name}" /><input type="hidden" class="J_pop_text_hide" value="{id}" /><a class="J_pop_item_cancel" href="javascript:;">取消</a></li>'.substitute(a);f.push(0===b?c.replace(" Hide",""):c)});MBOX.open({winCls:"pop-win pop-wraps",size:{x:400},url:MBOX.dialog("关联商户",'<div class="pop-msg-box pmb-error Hide" id="J_d_msg">请输入帖子中相关的商户名</div><div class="pop-win-inner"><div class="form-block register-form pop_sug" ><ul id="J_pop_list">'+
(f.length?f.join(""):'<li class="p-item J_pop_item" style="overflow:visible"><label class="label Hide">商户名：</label><input type="text" class="form-txt J_pop_text" value="{name}" /><input type="hidden" class="J_pop_text_hide" value="{id}" /><a class="J_pop_item_cancel" href="javascript:;">取消</a></li>'.substitute(i).replace(" Hide",""))+'<li><a id="J_pop_list_add" href="javascript:;">增加一项</a></li></ul></div><div class="form-btn-block"><strong class="btn-type-b btn-fn-c"><input type="button" class="form-btn" id="J_pop_ok" value="确定"></strong><strong class="btn-type-b btn-fn-d"><input type="button" class="form-btn" id="J_pop_cancel" value="取消"></strong></div></div>')}).content.set("class",
"ele-wrap");var g=1,h=$("J_d_msg"),j=$("J_pop_list"),k=$("J_pop_list_add");window.addEvent("resize",d);j.getElements(".J_pop_text").forEach(function(a){e(a)});j.getElements(".J_pop_item_cancel").addEvent("click",c);$("J_pop_ok").addEvent("click",function(a){a.stop();for(var a=[],b=j.getElementsByTagName("li"),c=0,d=b.length;c<d;c++){var e=$(b[c]),f=e.getElement(".J_pop_text_hide"),e=e.getElement(".J_pop_text");value=f?f.value:"";if(0!==value.length&&(a.push(value),0===e.value.trim().length)){h.removeClass("Hide");
return}}(new AjaxReq({url:"/ajax/json/group/note/bindNoteShop",method:"post",data:{groupId:DP.data("groupId"),shopId:a.join(","),noteId:DP.data("noteId")},onRequest:function(){MBOX_openLite("正在处理，请稍候......",{x:160})},onError:function(){MBOX_openLite("操作失败。  ",{x:140},!0)},onSuccess:function(a){a&&200==a.code?(MBOX_openLite("关联成功！ ",{x:150},!1),setTimeout(function(){refreshPage()},1E3)):(MBOX_openLite(a.msg&&a.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500))}})).send()});
$("J_pop_cancel").addEvent("click",function(a){a.stop();MBOX.close()});k.addEvent("click",function(a){a&&a.stop();a=j.getElements(".J_pop_item").length;if(!(5<=a)){var b=this.getParent(),d=(new Element("li",{"class":"p-item J_pop_item"})).set("html",'<label class="label Hide">商户名：</label><input type="text" class="form-txt J_pop_text" value="{name}" /><input type="hidden" class="J_pop_text_hide" value="{id}" /><a class="J_pop_item_cancel" href="javascript:;">取消</a>'.substitute(i)).setStyle("overflow",
"visible");d.getElement("a").addEvent("click",c);d.inject(b,"before");4==a&&k.addClass("Hide");e(d.getElement(".J_pop_text"))}})}else MBOX_openLite(b.msg&&b.msg.html||"发生未知错误，请稍候再试！",{x:300}),setTimeout(function(){MBOX.close()},1500)}})).send()});var e=function(a,b,c){DP.mbox.open({type:"string",size:{x:308,y:250},url:f,onShow:function(){var d=$("addCentMbox");new DP.Form.PlaceHolder(d.getElement("textarea"));d.getElement(".dialog-title").set("html",a);d.getElement(".J_pop_ok").addEvent("click",function(){var a=
$("addCentMbox");if(h()){var d="/ajax/json/group/note/noteGoodOriginal",a={noteId:DP.data("noteId"),noteTitle:DP.data("noteTitle"),groupId:DP.data("groupId"),groupSetId:DP.data("groupSetId"),operate:a.getElement(".J-cent-radio:checked").get("value"),goldNumStr:a.getElement(".J-cent-num").get("value"),reason:a.getElement(".J_area_reason").get("value")};b?(a.followNoteId=b,a.followNoteUserId=c,d="/ajax/json/group/note/followNoteExcellent"):a.noteUserId=DP.data("noteUserId");(new AjaxReq({url:d,method:"post",
data:a,onSuccess:function(a){var b='<div style="text-align:center;line-height:30px;">'+a.msg+"</div>",c='<div style="text-align:center;line-height:30px;color:white;background:red;">'+a.msg+"!</div>";if(a&&a.code==200){DP.mbox.openLite(b,false);setTimeout(function(){location.reload()},1500)}else{DP.mbox.openLite(c,false);setTimeout(function(){DP.mbox.close()},1500)}}})).send()}});d.getElement(".J_area_reason").addEvent("keyup",h);d.getElement(".J_pop_cancel").addEvent("click",function(){DP.mbox.close()})}})},
h=function(){var a=$("addCentMbox"),b=a.getElement(".J-cent-num").get("value"),c=a.getElement(".J_area_reason").get("value"),d=a.getElement(".pmb-error"),a=a.getElement(" textarea").get("placeholder");if(!b.test(/^[0-9]+$/)||1>b||300<b)return d.set("html","请输入1-300范围的分值").removeClass("Hide"),!1;if(0==c.length||c==a)return d.set("html","请填写加减分理由").removeClass("Hide"),!1;if(10<c.length)return d.set("html","加减分理由最多10字哦").removeClass("Hide"),!1;d.addClass("Hide");return!0},f='<div id="addCentMbox"><div class="dialog-title"></div><div class="dialog-cont"><div id="J_d_msg" class="pop-msg-box pmb-error Hide"></div><div class="pop-win-inner"><div class="form-block"><input type="radio" name="cent-radio" value="0" class="J-cent-radio" checked="true">加分<input type="radio" name="cent-radio" value="1" class="J-cent-radio">减分</div><div class="form-block"><label class="label" for=""><em>*</em>分值：</label><input type="text" style="width: 80px;" class="form-txt J-cent-num" value="5"><label style="width:100px;color:gray" class="label">数值范围1-300</label></div><div class="form-block"><label class="label" for=""><em>*</em>理由：</label><textarea placeholder="最多10个字" rows="3" class="form-textarea form-default row3fix J_area_reason" type="text" id="J_area_reason"></textarea></div><div class="form-btn-block"><span class="btn-type-a btn-fn-a"><a  href="javascript:;" class="form-btn J_pop_ok">确定</a></span><span class="btn-type-a btn-fn-b"><a  href="javascript:;" class="form-btn J_pop_cancel">取消</a></span></div></div></div></div>';
$$("a.J-addOriginCent").addEvent("click",function(a){a&&a.stop();e("原创积分")});$$("a.J-addReCent").addEvent("click",function(a){a&&a.stop();var b=a.target,a=b.get("data-follownoteid"),b=b.get("data-follownoteuserid");e("优质回帖",a,b)})})})(window);
