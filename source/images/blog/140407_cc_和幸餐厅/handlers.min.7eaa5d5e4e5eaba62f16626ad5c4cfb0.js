(function(n){n._Handlers=function(k){var s=n.mbox,h=k.fileUploadLimit,l=0,f=0,j=0,d,t=0,k=$("J_container"),u=k.getElement(".J_tipsBox"),v=u.getElement(".J_tips");u.getElement(".J_btnContinue");var w=k.getElement(".J_startBox"),z=w.getElement(".box-btnUp"),x=k.getElement(".J_listBox"),p=x.getElement(".J_ul"),A=p.getElement(".J_li"),m=k.getElement(".J_statusBox"),o=m.getElement(".J_totalProgress"),B=o.getElement(".J_percent"),C=o.getElement(".J_num"),q=m.getElement(".J_btns"),D=m.getElement(".J_finish"),
E=m.getElement(".J_quit"),e=function(b,a,c,i,f,g,y){var d;d=b.id&&$(b.id)?$(b.id):(new Element("li",{id:b.id,"class":"J_picLi",style:"border:1px solid #FFF;",title:"拖动图片进行排序",html:A.get("html")})).inject(p);var e=d.getElement(".J_image"),k=e.getElement(".J_pic"),h=e.getElement(".J_cancel"),j=e.getElement(".J_progress"),l=j.getElement(".J_bar"),e=d.getElement(".J_state");k.setProperties({src:a.previewPicUrl,"data-picUrl":a.defaultPicUrl,"data-picId":a.picId,"data-width":a.displayWidth,"data-height":a.displayHeight});
c?(h.removeClass("Hide"),y&&h.set("title","删除"),h.removeEvents("click").addEvent("click",function(a){a.stop();y?d.destroy():n.SWFU.cancelUpload(b.id)})):h.addClass("Hide");i?(j.removeClass("Hide"),l.setStyle("width",f)):j.addClass("Hide");if(g){a="准备上传 开始上传 正在上传 上传成功 图片太大 图片为空 格式错误 请求错误 地址缺失 接口错误 安全错误 上传超限 上传失败 ID缺失 验证失败 取消上传 停止上传".split(" ");for(c=0;c<a.length;c++)a[c]==g&&(g="准备上传"==g?"<span>准备上传</span>":"开始上传"==g||"正在上传"==g?'<span><i class="icon-loading"></i>'+g+"</span>":"上传成功"==g?'<span class="msg-succ"><i class="icon-succ"></i>上传成功</span>':
"图片太大"==g?'<span class="msg-err"><i class="icon-err"></i>图片不能大于5M</span>':'<span class="msg-err"><i class="icon-err"></i>'+g+"</span>")}else g='<span class="msg-err"><i class="icon-err"></i>上传出错</span>';e.set("html",g)},r=function(b,a){B.setStyle("width",100*(b/a)+"%");C.set("text",b+"/"+a)};this.swfUploadPreLoad=function(){};this.swfUploadLoadFailed=function(){var b=Browser.Plugins.Flash,a=b.version,b=b.build,c="";!a&&!b?c='您的浏览器未安装或者已禁用Adobe Flash Player插件，未能载入上传按钮。<a href="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" target="_blank" style="color:#0058bc; font-size:1.2em; font-style:italic;">下载并安装>></a>':
9>a&&(c='您的浏览器安装的Adobe Flash Player插件版本过低，为保证您能正常上传图片，建议升级到更高的版本。<a href="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" target="_blank" style="color:#0058bc; font-size:1.2em; font-style:italic;">下载更新>></a>');w.set("html",c)};this.swfUploadLoaded=function(){d=n.SWFU};this.fileQueued=function(b){j++;e(b,"",!1,!1,"","准备上传")};this.fileQueueError=function(b,a){-100!==a&&(-110==a?e(b,"",!0,!1,"","图片太大",!0):-120==a?e(b,"",!0,!1,"","图片为空",!0):-130==a?e(b,"",!0,!1,"",
"格式错误",!0):e(b,"",!0,!1,"","",!0))};this.fileDialogComplete=function(b,a){0<b&&b<=h-f&&((x.removeClass("Hide").setStyles({position:"absolute",top:"73px"}),q.addClass("Hide"),0==f&&(d.setButtonImageURL("#"),d.setButtonText('<a href="#" class="btnContinue">继续上传»</a>'),d.setButtonTextStyle(".btnContinue {color:#FF6600; font-size:12px;}"),d.setButtonDimensions("0","0"),z.setStyles({position:"absolute",background:"none",width:"80px",height:"18px",left:"560px",top:"40px"})),0==a)?(q.removeClass("Hide"),
d.setButtonDimensions("80","18")):a<=h-f&&(a<h-f?(v.set("text","您已经选择上传了"+(f+a)+"张，还可以再选择上传"+(h-(f+a))+"张，"),d.setButtonDimensions("80","18")):a===h-f&&(v.set("text","您已经选择上传满"+h+"张。"),d.setButtonDimensions("0","0")),m.removeClass("Hide"),o.removeClass("Hide"),f+=a,r(l,f),d.startUpload()))};this.uploadStart=function(b){e(b,"",!1,!0,"1%","开始上传")};this.uploadProgress=function(b,a,c){e(b,"",!0,!0,100*(a/c)+"%","正在上传")};this.uploadError=function(b,a){var c="";switch(a){case -200:c="请求错误";break;case -210:c=
"地址缺失";break;case -220:c="接口错误";break;case -230:c="安全错误";break;case -240:c="上传超限";break;case -250:c="上传失败";break;case -260:c="ID缺失";break;case -270:c="验证失败";break;case -280:c="取消上传";break;case -290:c="停止上传"}j--;e(b,"",!0,!1,"",c,!0);l++;r(l,f)};this.uploadSuccess=function(b,a){var c=(new Date).getTime(),i;a?i=JSON.decode(a):i={};if(i&&200==i.code){var d=i.url,g=i.width;i=i.height;(new Request.JSON({method:"post",url:"/ajax/json/group/groupPicAdd",data:{picType:DP.data("picType")||0,picUrl:d,realWidth:g,
realHeight:i},onSuccess:function(a){a=a.msg;a={previewPicUrl:a.previewPicUrl,picId:a.picId,defaultPicUrl:a.defaultPicUrl,displayWidth:a.displayWidth,displayHeight:a.displayHeight};j--;e(b,a,!0,!1,"","上传成功",!0);t+=(new Date).getTime()-c;l++;r(l,f)},onFailure:function(){j--;e(b,"",!0,!1,"","",!0)}})).send()}else j--,e(b,"",!0,!1,"","",!0)};this.uploadComplete=function(){};this.queueComplete=function(){var b=setInterval(function(){j||(clearInterval(b),o.addClass("Hide"),q.removeClass("Hide"),new Sortables("#J_container .J_ul",
{handle:!1,opacity:0.8,revert:!0,dragOptions:{},onStart:function(a){a.setStyle("borderColor","#F90");Browser.ie&&a.setStyle("filter","alpha(opacity=80)")},onSort:function(){},onComplete:function(a){a.setStyle("borderColor","#FFF")}}),D.removeEvents("click").addEvent("click",function(a){a.stop();var b="";p.getElements(".J_picLi .J_pic").forEach(function(a){a.get("data-picid")&&(b+='<a href="'+a.get("data-picurl")+'" target="_blank"><img data-picid="'+a.get("data-picid")+'" src="'+a.get("data-picurl")+
'" width="'+a.get("data-width")+'" height="'+a.get("data-height")+'" border="0"/></a><br/><br/>')});window.SnicEditor.insertPic(b);d.destroy();s.close()}),E.addEvent("click",function(){d.destroy();s.close()}))},100)}}})(DP);
